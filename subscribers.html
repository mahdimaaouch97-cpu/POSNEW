<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>المشتركين</title>
<link rel="stylesheet" href="assets/css/style.css">
<style>
/* تنسيق النموذج داخل المشتركين */
.subscribers-section form {
    margin-bottom: 20px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
}

.subscribers-section form input,
.subscribers-section form select {
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
    flex: 1 1 200px;
}

.subscribers-section form button {
    flex: 0 0 auto;
}
</style>
</head>
<body>
<header>
<h1>المشتركين</h1>
<nav>
<ul>
<li><a href="index.html">الرئيسية</a></li>
<li><a href="subscribers.html" class="active">المشتركين</a></li>
<li><a href="payments.html">الدفع</a></li>
<li><a href="packages.html">الباقات</a></li>
<li><a href="receipts.html">الإيصالات</a></li>
<li><a href="report.html">التقارير</a></li>
<li><a href="login.html">تسجيل الخروج</a></li>
</ul>
</nav>
</header>

<main>
<section class="subscribers-section">
<h2>إضافة مشترك جديد</h2>

<form id="subscriberForm">
<input type="text" id="subscriberName" placeholder="اسم المشترك" required>
<select id="subscriberPackage" required>
<option value="">اختر الباقة</option>
</select>
<button type="submit">إضافة المشترك</button>
</form>

<table id="subscribersTable">
<thead>
<tr>
<th>الرقم</th>
<th>اسم المشترك</th>
<th>الباقة</th>
<th>الإجراءات</th>
</tr>
</thead>
<tbody></tbody>
</table>
</section>
</main>

<footer>
<p>© 2026 FAST NET. جميع الحقوق محفوظة.</p>
</footer>

<script>
// تحميل البيانات من LocalStorage
let subscribers = JSON.parse(localStorage.getItem("subscribers")) || [];
let packages = JSON.parse(localStorage.getItem("packages")) || [];

// تعبئة قائمة الباقات
const packageSelect = document.getElementById("subscriberPackage");
packages.forEach(pkg => {
    const option = document.createElement("option");
    option.value = pkg.name;
    option.textContent = pkg.name;
    packageSelect.appendChild(option);
});

// عرض المشتركين في الجدول
function renderSubscribers() {
    const tbody = document.querySelector("#subscribersTable tbody");
    tbody.innerHTML = "";
    subscribers.forEach((sub, index)=>{
        const row = document.createElement("tr");
        row.innerHTML = `
        <td>${index+1}</td>
        <td>${sub.name}</td>
        <td>${sub.package}</td>
        <td>
            <button onclick="editSubscriber(${index})">تعديل</button>
            <button onclick="deleteSubscriber(${index})">حذف</button>
        </td>
        `;
        tbody.appendChild(row);
    });
    localStorage.setItem("subscribers", JSON.stringify(subscribers));
}

// إضافة مشترك جديد عبر النموذج
document.getElementById("subscriberForm").addEventListener("submit", function(e){
    e.preventDefault();
    const name = document.getElementById("subscriberName").value.trim();
    const pkg = document.getElementById("subscriberPackage").value;

    if(!name || !pkg){
        alert("يرجى إدخال الاسم واختيار الباقة!");
        return;
    }

    subscribers.push({name:name, package:pkg});
    renderSubscribers();
    this.reset();
});

// تعديل مشترك
function editSubscriber(index){
    const sub = subscribers[index];
    const newName = prompt("تعديل اسم المشترك:", sub.name);
    if(!newName) return;
    const newPkg = prompt("تعديل الباقة:", sub.package);
    if(!newPkg) return;
    subscribers[index] = {name:newName, package:newPkg};
    renderSubscribers();
}

// حذف مشترك
function deleteSubscriber(index){
    if(confirm("هل تريد حذف هذا المشترك؟")){
        subscribers.splice(index,1);
        renderSubscribers();
    }
}

// عند تحميل الصفحة
window.onload = renderSubscribers;
</script>
</body>
</html>
